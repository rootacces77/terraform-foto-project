
<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <!-- FIX: viewport-fit=cover enables safe-area insets on iOS -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="icon" href="./logo.jpeg" sizes="32x32">
  <title>„Foto Duga" Bijeljina</title>

  <style>
    :root {
      --bg: #ffffff;
      --text: #0b1220;
      --muted: #5b6778;
      --border: #e6eaf0;

      --btn-bg: #f5f7fb;
      --btn-border: #d9e0ea;
      --btn-text: #0b1220;

      --header-bg: rgba(255,255,255,0.92);
      --header-blur: blur(10px);

      --tile-bg: #f3f5f8;

      --modal-backdrop: rgba(0,0,0,0.78);
      --modal-bar-bg: rgba(255,255,255,0.92);
      --modal-bar-border: rgba(0,0,0,0.10);

      --toast-bg: rgba(15, 23, 42, 0.92);
      --toast-text: #fff;

      --gap: 6px;         /* spacing between tiles */
      --row-h: 8px;       /* masonry row unit (smaller = smoother) */

      /* ===== Header insets (THIS controls left/right margins for header content) ===== */
      --header-pad-x: 28px;
      --header-pad-y: 12px;

      /* Optional extra nudges */
      --brand-nudge-x: 0px;
      --actions-nudge-x: 0px;
    }

    html[data-theme="dark"] {
      --bg: #0b1220;
      --text: #e6edf3;
      --muted: #b6c2d0;
      --border: #1e2a44;

      --btn-bg: #0f1730;
      --btn-border: #1e2a44;
      --btn-text: #e6edf3;

      --header-bg: rgba(17,26,46,0.92);
      --tile-bg: #111a2e;

      --modal-backdrop: rgba(0,0,0,0.82);
      --modal-bar-bg: rgba(17,26,46,0.92);
      --modal-bar-border: rgba(255,255,255,0.10);

      --toast-bg: rgba(0,0,0,0.78);
      --toast-text: #fff;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--header-bg);
      backdrop-filter: var(--header-blur);
      border-bottom: 1px solid var(--border);
    }

    /* Wider container + minimal left/right whitespace */
    .wrap {
      max-width: 1700px;
      margin: 0 auto;
      padding: var(--header-pad-y) 6px; /* base for all wrap blocks */
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .brandLeft {
      display: flex;
      align-items: center;
      gap: 18px;
      min-width: 0;
    }

    .brandLeft img {
      height: 56px;
      width: 56px;
      object-fit: cover;
      display: block;
    }

    .brandText {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
      min-width: 0;
    }

    .titleLeft {
      font-weight: 900;
      letter-spacing: 0.2px;
      font-size: 24px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .subtitle {
      margin-top: 4px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .muted { color: var(--muted); font-size: 13px; white-space: nowrap; }

    .actions { display:flex; align-items:center; gap:10px; }
    .btnRow { display:flex; gap:10px; align-items:center; }

    .btn {
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color: var(--btn-text);
      padding: 8px 10px;
      cursor: pointer;
      font-size: 13px;
      line-height: 1;
      user-select: none;
      white-space: nowrap;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn:hover { filter: brightness(1.03); }
    .btn:disabled { opacity: 0.55; cursor: not-allowed; }

    main.wrap { padding-top: 14px; }

    /* =========================================================
       MASONRY GRID (no holes) using CSS Grid + JS row-span
    ========================================================= */
    .grid {
      display: grid;
      gap: var(--gap);
      grid-auto-rows: var(--row-h);
      align-items: start;

      grid-template-columns: repeat(5, minmax(0, 1fr));
    }
    @media (max-width: 1400px) { .grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
    @media (max-width: 900px)  { .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    @media (max-width: 600px)  { .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }

    .tile {
      position: relative;
      background: var(--tile-bg);
      overflow: visible; /* important for square corners/no clipping */
      /* grid-row-end set by JS */
    }

    .tile img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;
      cursor: zoom-in;
    }

    .tile .tileOverlay {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 10px;
      text-align: center;
      background: rgba(0,0,0,0.55);
      color: #fff;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
    }
    .tile.broken .tileOverlay { display: flex; }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: var(--modal-backdrop);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 10px;
      z-index: 999;
    }
    .modal.open { display: flex; }

    .modal-inner {
      width: min(1200px, 98vw);
      height: min(94vh, 980px);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .modal-panel {
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
      background: transparent;
    }

    .modal-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: var(--modal-bar-bg);
      border: 1px solid var(--modal-bar-border);
      backdrop-filter: blur(10px);
    }

    .modal-title {
      color: var(--muted);
      font-size: 13px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 55vw;
    }

    .modal-stage {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      background: #000;
      --stage-bg: none;
    }

    .modal-stage::before{
      content:"";
      position:absolute;
      inset:-30px;
      background-image: var(--stage-bg);
      background-size: cover;
      background-position: center;
      filter: blur(26px) brightness(0.55) saturate(1.1);
      transform: scale(1.08);
      opacity: .95;
    }
    .modal-stage::after{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.10), rgba(0,0,0,0.65));
    }

    /* ====== DESKTOP MAX SIZE ====== */
    .modal-stage img {
      position: relative;
      z-index: 1;
      max-width: min(96vw, 1800px);
      max-height: min(84vh, 900px);
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
      cursor: zoom-out;
      box-shadow: 0 18px 60px rgba(0,0,0,0.35);
      background: transparent;
    }

    .navbtn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: #fff;
      cursor: pointer;
      user-select: none;
      z-index: 2;
    }
    .navbtn.left { left: 10px; }
    .navbtn.right { right: 10px; }
    .navbtn:hover { filter: brightness(1.10); }

    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: var(--toast-bg);
      color: var(--toast-text);
      padding: 10px 12px;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 18px 50px rgba(0,0,0,0.25);
      display: none;
      z-index: 2000;
      max-width: min(92vw, 720px);
      text-align: center;
    }
    .toast.show { display: block; }

    /* Mobile header + modal fullscreen */
    @media (max-width: 700px) {
      .wrap { padding: 10px 6px; }

      .topbar {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }

      .brandLeft { width: 100%; justify-content: flex-start; gap: 14px; }
      .brandLeft img { height: 44px; width: 44px; }
      .titleLeft { font-size: 18px; }
      .subtitle { font-size: 12px; }

      #status { display: none; }
      .actions { width: 100%; }
      .btnRow { width: 100%; }
      .btnRow .btn { flex: 1; padding: 10px 10px; font-size: 13px; }

      .modal { padding: 0; }
      .modal-inner { width: 100vw; height: 100vh; gap: 10px; padding: 10px; }

      /* ====== PHONE MAX SIZE ====== */
      .modal-stage img { max-width: 98vw; max-height: 82vh; }
    }

    /* =========================================================
       FORCE OVERRIDES (put at end so they always win)
       - Header inset (logo/title right + download left)
       - Remove ALL rounded corners
    ========================================================= */

    /* Header insets */
    header .wrap {
      padding-left: var(--header-pad-x) !important;
      padding-right: var(--header-pad-x) !important;
      padding-top: var(--header-pad-y) !important;
      padding-bottom: var(--header-pad-y) !important;
    }

    header .brandLeft {
      padding-left: var(--brand-nudge-x) !important;
    }

    header .actions {
      padding-right: var(--actions-nudge-x) !important;
    }

    /* NO rounded corners anywhere */
    .brandLeft img,
    .btn,
    .tile,
    .tile img,
    .modal-panel,
    .modal-bar,
    .modal-stage,
    .modal-stage img {
      border-radius: 0 !important;
    }

    /* =========================================================
       FIX: iPhone/Android in-app browser safe-area + modal header not cut off
       (these are the only NEW parts)
    ========================================================= */

    /* Ensure modal respects notches / status bars */
    @supports (padding: env(safe-area-inset-top)) {
      .modal {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }
    }

    /* Make modal truly fullscreen and stable on phones */
    @media (max-width: 700px) {
      .modal { padding: 0 !important; }

      .modal-inner {
        width: 100vw !important;
        height: 100dvh !important; /* fixes dynamic browser bar */
        padding: 0 !important;
        gap: 0 !important;
      }

      .modal-panel { height: 100% !important; }

      /* Always-visible header bar */
      .modal-bar {
        position: sticky;
        top: 0;
        z-index: 5;
        padding-top: calc(10px + env(safe-area-inset-top)) !important;
      }

      /* Let title shrink so buttons remain visible */
      .modal-title { max-width: 52vw !important; }

      #modalDownload, #modalClose { flex: 0 0 auto; }

      .modal-stage { min-height: 0; }
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap topbar">
      <div class="brandLeft">
        <img src="./logo.jpeg" alt="Logo" />
        <div class="brandText">
          <div class="titleLeft">„Foto Duga" Bijeljina</div>
          <div class="subtitle">Foto studio • Bijeljina</div>
        </div>
      </div>

      <div id="status" class="muted">Loading…</div>

      <div class="actions">
        <div class="btnRow">
          <button id="dlFolder" class="btn" style="display:none">Download folder (ZIP)</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="grid" class="grid"></div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-inner">
      <div class="modal-panel">
        <div class="modal-bar">
          <div class="modal-title" id="modalTitle"></div>
          <div style="display:flex; gap:8px; align-items:center;">
            <a id="modalDownload" class="btn" href="#" download>Download</a>
            <button id="modalClose" class="btn" type="button">Close</button>
          </div>
        </div>

        <div class="modal-stage" id="modalStage">
          <button class="navbtn left" id="prevBtn" aria-label="Previous">←</button>
          <img id="modalImg" alt="preview" />
          <button class="navbtn right" id="nextBtn" aria-label="Next">→</button>
        </div>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>